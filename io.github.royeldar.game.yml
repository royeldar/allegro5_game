id: io.github.royeldar.game
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: game

finish-args:
  - --device=dri
  - --share=ipc
  - --socket=pulseaudio
  - --socket=x11

cleanup:
  - '/include'
  - '/lib/cmake'
  - '/lib/pkgconfig'
  - '*.a'
  - '*.la'

modules:
  - name: minimp3
    buildsystem: simple
    build-commands:
      - install -D -m 644 -t ${FLATPAK_DEST}/include/ minimp3.h minimp3_ex.h
    sources:
      - type: git
        url: https://github.com/lieff/minimp3.git
        commit: afb604c06bc8beb145fecd42c0ceb5bda8795144
  - name: physfs
    buildsystem: cmake
    config-opts:
      - -D CMAKE_POLICY_VERSION_MINIMUM=3.5
      - -D CMAKE_INSTALL_LIBDIR=lib
      - -D PHYSFS_BUILD_TEST=OFF
      - -D PHYSFS_BUILD_DOCS=OFF
    sources:
      - type: archive
        url: https://github.com/icculus/physfs/archive/refs/tags/release-3.2.0.tar.gz
        sha256: 1991500eaeb8d5325e3a8361847ff3bf8e03ec89252b7915e1f25b3f8ab5d560
  - name: dumb
    buildsystem: cmake
    config-opts:
      - -D CMAKE_POLICY_VERSION_MINIMUM=3.5
      - -D CMAKE_INSTALL_LIBDIR=lib
      - -D BUILD_ALLEGRO4=OFF
      - -D BUILD_EXAMPLES=OFF
      - -D CMAKE_POSITION_INDEPENDENT_CODE=ON
    sources:
      - type: git
        url: https://github.com/kode54/dumb.git
        commit: 396caa4d31859045ccb5ef943fd430ca4026cce8
  - name: freeimage
    buildsystem: simple
    build-commands:
      - sed -i 's/ -o root -g root//g' Makefile.gnu
      - make -j ${FLATPAK_BUILDER_N_JOBS} CC='gcc -Wno-implicit-function-declaration' CXX='g++ -std=gnu++14'
      - make install INCDIR=${FLATPAK_DEST}/include INSTALLDIR=${FLATPAK_DEST}/lib
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/freeimage/FreeImage3180.zip
        sha256: f41379682f9ada94ea7b34fe86bf9ee00935a3147be41b6569c9605a53e438fd
  - name: openmpt
    buildsystem: autotools
    config-opts:
      - --disable-openmpt123
      - --disable-examples
      - --disable-tests
      - --disable-doxygen-doc
    sources:
      - type: archive
        url: https://lib.openmpt.org/files/libopenmpt/src/libopenmpt-0.8.4+release.autotools.tar.gz
        sha256: 627f9bf11aacae615a1f2c982c7e88cb21f11b2d6f0267946f7c82c5eae4943b
  - name: allegro5
    buildsystem: cmake
    builddir: true
    config-opts:
      - -D CMAKE_INSTALL_LIBDIR=lib
      - -D WANT_DOCS=OFF
      - -D WANT_DEMO=OFF
      - -D WANT_EXAMPLES=OFF
      - -D WANT_TESTS=OFF
    sources:
      - type: archive
        url: https://github.com/liballeg/allegro5/releases/download/5.2.11.2/allegro-5.2.11.2.tar.gz
        sha256: f035fe128dd5f2412c32add41ed4058ad8154f6e9571084574487d67dbdbaae0
  - name: game
    buildsystem: meson
    sources:
      - type: dir
        path: src
